___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "categories": [
    "ADVERTISING", "CONVERSIONS", "ANALYTICS", "REMARKETING"
  ],
  "displayName": "Bing/Microsoft Ads Conversions (Events)",
  "brand": {
    "id": "brand_dummy",
    "displayName": "",
    "thumbnail": "data:image/png;base64,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\u003d\u003d"
  },
  "description": "Tag for sending conversions of Event type back to Bing/Microsoft Ads.\nInfo: https://github.com/rodfchaves/bing-microsoft-conversion-tag",
  "containerContexts": [
    "SERVER"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "LABEL",
    "name": "label1",
    "displayName": "All fields with star (*) are required."
  },
  {
    "type": "TEXT",
    "name": "ti",
    "displayName": "UET Tag ID*",
    "simpleValueType": true,
    "canBeEmptyString": false
  },
  {
    "type": "SELECT",
    "name": "evt",
    "displayName": "Event Type*",
    "macrosInSelect": false,
    "selectItems": [
      {
        "value": "pageLoad",
        "displayValue": "Page Load"
      },
      {
        "value": "custom",
        "displayValue": "Custom"
      }
    ],
    "simpleValueType": true,
    "defaultValue": "pageLoad"
  },
  {
    "type": "LABEL",
    "name": "customEvents",
    "displayName": "Custom Event Data",
    "enablingConditions": [
      {
        "paramName": "evt",
        "paramValue": "custom",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "ea",
    "displayName": "Event Action",
    "simpleValueType": true,
    "canBeEmptyString": true,
    "enablingConditions": [
      {
        "paramName": "evt",
        "paramValue": "custom",
        "type": "EQUALS"
      }
    ],
    "help": "Defaults to: event_action"
  },
  {
    "type": "TEXT",
    "name": "ec",
    "displayName": "Event Category",
    "simpleValueType": true,
    "canBeEmptyString": true,
    "enablingConditions": [
      {
        "paramName": "evt",
        "paramValue": "custom",
        "type": "EQUALS"
      }
    ],
    "help": "Defaults to: event_category"
  },
  {
    "type": "TEXT",
    "name": "el",
    "displayName": "Event Label",
    "simpleValueType": true,
    "canBeEmptyString": true,
    "enablingConditions": [
      {
        "paramName": "evt",
        "paramValue": "custom",
        "type": "EQUALS"
      }
    ],
    "help": "Defaults to: event_label"
  },
  {
    "type": "TEXT",
    "name": "ev",
    "displayName": "Event Value",
    "simpleValueType": true,
    "canBeEmptyString": true,
    "enablingConditions": [
      {
        "paramName": "evt",
        "paramValue": "custom",
        "type": "EQUALS"
      }
    ],
    "help": "Defaults to: event_value"
  },
  {
    "type": "TEXT",
    "name": "msclkidCookie",
    "displayName": "Microsoft Click ID (from the cookie)",
    "simpleValueType": true,
    "canBeEmptyString": true,
    "help": "msclkid from the cookie. Defaults to: _uetmsclkid cookie."
  },
  {
    "type": "TEXT",
    "name": "msclkidQuery",
    "displayName": "Microsoft Click ID (from the URL)",
    "simpleValueType": true,
    "canBeEmptyString": true,
    "help": "msclkid from the URL. Defaults to: msclkid param from the page_location."
  },
  {
    "type": "TEXT",
    "name": "user_id",
    "displayName": "User ID",
    "simpleValueType": true,
    "canBeEmptyString": true,
    "help": "ID from a logged user. Defaults to: user_id"
  },
  {
    "type": "TEXT",
    "name": "vid",
    "displayName": "Client ID",
    "simpleValueType": true,
    "canBeEmptyString": true,
    "help": "ID from a non-logged user. Defaults to: client_id"
  },
  {
    "type": "TEXT",
    "name": "pageLocation",
    "displayName": "Page URL",
    "simpleValueType": true,
    "canBeEmptyString": true,
    "help": "Defaults to: page_location"
  },
  {
    "type": "TEXT",
    "name": "pageReferrer",
    "displayName": "Referrer URL",
    "simpleValueType": true,
    "canBeEmptyString": true,
    "help": "Defaults to: page_referrer"
  },
  {
    "type": "TEXT",
    "name": "pageTitle",
    "displayName": "Page title",
    "simpleValueType": true,
    "canBeEmptyString": true,
    "help": "Defaults to: page_title"
  },
  {
    "type": "TEXT",
    "name": "pagePath",
    "displayName": "Page Path",
    "simpleValueType": true,
    "canBeEmptyString": true,
    "help": "Defaults to: page_path"
  },
  {
    "type": "TEXT",
    "name": "searchTerm",
    "displayName": "Search Term",
    "simpleValueType": true,
    "canBeEmptyString": true,
    "help": "The search query the user entered prior to arriving at the search results page.\nDefaults to: search_term"
  },
  {
    "type": "SELECT",
    "name": "pagetype",
    "displayName": "Page Type",
    "macrosInSelect": true,
    "selectItems": [
      {
        "value": "category",
        "displayValue": "Category"
      },
      {
        "value": "searchresults",
        "displayValue": "Search Results"
      },
      {
        "value": "product",
        "displayValue": "Product"
      },
      {
        "value": "cart",
        "displayValue": "Cart"
      },
      {
        "value": "purchase",
        "displayValue": "Purchase"
      },
      {
        "value": "home",
        "displayValue": "Home"
      },
      {
        "value": "other",
        "displayValue": "Other"
      }
    ],
    "simpleValueType": true,
    "defaultValue": "home"
  },
  {
    "type": "LABEL",
    "name": "ecommerce",
    "displayName": "Ecommerce Data"
  },
  {
    "type": "TEXT",
    "name": "transactionId",
    "displayName": "Transaction ID",
    "simpleValueType": true
  },
  {
    "type": "TEXT",
    "name": "ecommCategory",
    "displayName": "Ecommerce Category",
    "simpleValueType": true,
    "canBeEmptyString": true,
    "help": "The ID of the category for the category browse page."
  },
  {
    "type": "TEXT",
    "name": "items",
    "displayName": "Ecommerce Items",
    "simpleValueType": true,
    "help": "An array that includes details of products, such as product ID and price. This array should be captured on pages and events involving multiple products, such as an add-to-cart event, visiting the cart page, or visiting the purchase confirmation page.\n\nYou can also mark the checkbox below and send the standard Google Analytics datalayer ecommerce.items\n\nExample: id\u003dprodABCD\u0026quantity\u003d2\u0026price\u003d53.4,id\u003dprodABC\u0026quantity\u003d1\u0026price\u003d121.1\n\nDefaults to: items"
  },
  {
    "type": "CHECKBOX",
    "name": "itemsGa",
    "checkboxText": "Use the structure from Google Analytics ecommerce items",
    "simpleValueType": true
  },
  {
    "type": "TEXT",
    "name": "prodid",
    "displayName": "Product IDs",
    "simpleValueType": true,
    "canBeEmptyString": true,
    "help": "This parameter captures a comma-separated list of product IDs that the user has viewed. It supports multiple product IDs when the page displays more than one product. Each product ID is unique for each item and must match either the ID or item_group_id attribute in the product feed submitted through.\n\nExample: pid1,pid2,pid3,pid4,pid5,pid6,pid7,pid8,pid9,pid10"
  },
  {
    "type": "CHECKBOX",
    "name": "prodidGa",
    "checkboxText": "Use the structure from Google Analytics ecommerce items",
    "simpleValueType": true
  },
  {
    "type": "TEXT",
    "name": "gc",
    "displayName": "Currency",
    "simpleValueType": true,
    "help": "The currency being used in the transaction.\n\nExample: usd\n\nDefaults to: currency",
    "canBeEmptyString": true
  },
  {
    "type": "TEXT",
    "name": "gv",
    "displayName": "Value",
    "simpleValueType": true,
    "help": "For use in conversion tracking to report variable revenue.\n\nDefaults to: value",
    "canBeEmptyString": true
  },
  {
    "type": "CHECKBOX",
    "name": "spa",
    "checkboxText": "Single-page application",
    "simpleValueType": true
  },
  {
    "type": "CHECKBOX",
    "name": "createCookie",
    "checkboxText": "Automatically create the _uetmsclkid cookie",
    "simpleValueType": true
  },
  {
    "type": "CHECKBOX",
    "name": "firstClick",
    "checkboxText": "First Click mode (check this if you want to track the first click ID)",
    "simpleValueType": true
  },
  {
    "type": "CHECKBOX",
    "name": "activateLogs",
    "checkboxText": "Activate Logs",
    "simpleValueType": true
  }
]


___SANDBOXED_JS_FOR_SERVER___

const sendHttpGet = require('sendHttpGet');
const getEventData = require('getEventData');
const generateRandom = require('generateRandom');
const logToConsole = require('logToConsole');
const Math = require('Math');
const encodeUriComponent = require('encodeUriComponent');
const JSON = require('JSON');
const getCookieValues = require('getCookieValues');
const setCookie = require('setCookie');
const parseUrl = require('parseUrl');


let clickid;
function isNotEmpty(obj) {
  if(obj == undefined || obj == null || obj.toString() == "" ) {
    return false;
  } else {
    return obj;
  }
}

let msquery = () => {
  if(parseUrl(getEventData('page_location'))) {
    if (parseUrl(getEventData('page_location')).searchParams.msclkid) {      
      return parseUrl(getEventData('page_location')).searchParams.msclkid;
    } else {
      return false;
    } 
  } else {
    return false;
  }
};

function setUETCookie(clickid) {
    setCookie('_uetmsclkid', "_uet"+clickid, {"expires":7776000000, httpOnly: false});
    if(data.activateLogs) {
      logToConsole("Cookie set: " + clickid);
    }
}

if(data.first_click) {
  if (isNotEmpty(data.msclkidCookie) || isNotEmpty(getCookieValues('_uetmsclkid'))) {
    let clickid_cookie = getCookieValues('_uetmsclkid')[0];
    clickid = (isNotEmpty(data.msclkidCookie) || (clickid_cookie.substring(4)));
    clickid += "-0";
  } else { //cookie not present
    if (isNotEmpty(data.msclkidQuery) || msquery()) {
      clickid = (isNotEmpty(data.msclkidQuery) || msquery());
      setUETCookie(clickid);
      clickid += "-1";
    } else {
      clickid = "N";
    }
  }
} else {
  if (isNotEmpty(data.msclkidQuery) || msquery()) {
    clickid = (isNotEmpty(data.msclkidQuery) || msquery());
    setUETCookie(clickid);     
    clickid += "-1";
  } else {
    if(isNotEmpty(data.msclkidCookie) || isNotEmpty(getCookieValues('_uetmsclkid'))){
      let clickid_cookie = getCookieValues('_uetmsclkid')[0];
      clickid = (isNotEmpty(data.msclkidCookie) || (clickid_cookie.substring(4)));
      clickid += "-0";
    } else {
      clickid = "N";
    }
  }
}


const screen = data.screen || getEventData('screen_resolution');

let width, height = "";
if (isNotEmpty(screen)){
  width = screen.split('x')[0];
  height = screen.split('x')[1];

}
let rn = generateRandom(100000, 999999);
function s4() {
    return Math.floor(((1 + (generateRandom(1, 9999999)/10000000))) * 65536)
        .toString(16)
        .substring(1);
}

let mid = (s4() + s4() + "-" + s4() + "-" + s4() + "-" + s4() + "-" + s4() + s4() + s4());
let items_data;
if(isNotEmpty(getEventData('items'))){
  items_data = getEventData('items');
}

let items = () => {
  let result = "";
  if(isNotEmpty(data.prodid)){
    items_data = data.prodid;    
  }
  if (data.itemsGa) {
    if(items_data) {
      items_data.forEach(function(item, i) {
        result += "id=" + item.item_id + 'quantity=' + item.quantity + 'price=' + item.price;
        if (i < items_data.length - 1) {
          result += ',';
        }
      });
    }
  } else {
    result = items_data;
  }
  return result;
};


let items_id = () => {  
  let result = "";
  if(isNotEmpty(data.items)){
    items_data = data.items;
  }
  if(data.prodidGa) {
    if (items_data) {
      items_data.forEach(function(item, i) {
        result += item.item_id;
        if (i < items_data.length - 1) {
          result += ',';
        }   
      });
    }
  }
  return result;
};

let spa = () => {
  if(data.spa) {
    return "Y";
  } else {
    return "N";
  }
};

let params = {};

params.rn = rn;
params.ti = data.ti;
params.ver = '2.3';
params.mid = mid;
params.uid = isNotEmpty(data.userId) || getEventData('user_id');
params.evt = data.evt;
params.p = isNotEmpty(data.pageLocation) || getEventData('page_location');
params.r = isNotEmpty(data.pageReferrer) || getEventData('page_referrer');
params.tl = isNotEmpty(data.pageTitle) || getEventData('page_title');
params.pagetype = data.pagetype;
params.items =  items();
params.prodid = items_id();
params.search_term = isNotEmpty(data.searchTerm) || getEventData('search_term');
params.transaction_id = isNotEmpty(data.transactionId) || getEventData('transaction_id');
params.lg = isNotEmpty(data.lg) || getEventData('language');
params.sw = width;
params.sh = height;
params.sc = data.sc || getEventData('screen_color_depth');
params.spa = spa();
params.msclkid = clickid;
params.sid = isNotEmpty(data.sid) || getEventData('uet_session_id');
params.vid = isNotEmpty(data.vid) || getEventData('vid');
params.page_path = isNotEmpty(data.pagePath) || getEventData('page_path');
params.gc = isNotEmpty(data.gc) || getEventData('currency');
params.gv = isNotEmpty(data.gv) || getEventData('value');
params.ec = isNotEmpty(data.ec) || getEventData('event_category');
params.ea = isNotEmpty(data.ea) || getEventData('event_action');
params.el = isNotEmpty(data.el) || getEventData('event_label');
params.ev = isNotEmpty(data.ev) || getEventData('event_value');

if (data.activateLogs) {
  logToConsole("Params: " + JSON.stringify(params));  
}


let url = 'https://bat.bing.com/action/0?';
let all_params = "";
if(isNotEmpty(params)){
  for (var key in params){
    if (params[key] == undefined || params[key] == null) {
      continue;
    }
    all_params += key + "=" + encodeUriComponent(params[key]) + "&";
  }
  url += all_params;
}
if (data.activateLogs) {
  logToConsole('URL: ' + url);
}


return sendHttpGet(url, {
  headers: {key: 'value'},
  timeout: 500,
}).then((result) => {
  if (result.statusCode >= 200 && result.statusCode < 300) {
    logToConsole('Result: ' + data.gtmOnSuccess());
    data.gtmOnSuccess();
  } else {
    logToConsole('Error: ' + result.statusCode);
    data.gtmOnFailure();
  }
});


___SERVER_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "send_http",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedUrls",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://bat.bing.com/*"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "read_event_data",
        "versionId": "1"
      },
      "param": [
        {
          "key": "eventDataAccess",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "all"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "get_cookies",
        "versionId": "1"
      },
      "param": [
        {
          "key": "cookieAccess",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "cookieNames",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "_uetmsclkid"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "set_cookies",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedCookies",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "name"
                  },
                  {
                    "type": 1,
                    "string": "domain"
                  },
                  {
                    "type": 1,
                    "string": "path"
                  },
                  {
                    "type": 1,
                    "string": "secure"
                  },
                  {
                    "type": 1,
                    "string": "session"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "_uetmsclkid"
                  },
                  {
                    "type": 1,
                    "string": "*"
                  },
                  {
                    "type": 1,
                    "string": "*"
                  },
                  {
                    "type": 1,
                    "string": "any"
                  },
                  {
                    "type": 1,
                    "string": "any"
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios:
- name: Test 1
  code: "// Call runCode to run the template's code with a lowercase string\nlet variableResult\
    \ = runCode({\n  first_click: false,\n  activate_logs: true,\n  ti: \"test\",\n\
    \  user_id: 'user id',\n  evt: 'pageLoad',\n  page_location: 'https://mypage.com.br/registration?msclkid=292049a17e2413e3a4081719e839afe6',\n\
    \  page_refferer: 'https://bing.com',\n  page_tile: 'My Page',\n  pagetype: 'Home',\n\
    \  prodid: undefined,\n  kw: 'pagekewyord, word3',\n  search_term: 'wall%20clocks',\n\
    \  transaction_id: 'sdj32jhDH32',\n  lg: 'pt-BR',\n  sw: '1080',\n  sh: '720',\n\
    \  sc: undefined,\n  pi: undefined,\n  spa: true,\n  msclkid_query: 'query_test',\n\
    \  msclkid_cookie: undefined,  \n  sid: 'session id',\n  vid: 'anonymous id',\n\
    \  page_path: '/checkout',\n  items_ga: true,\n  prodid_ga: true,\n  items: \"\
    \",\n  gc: 'usd',\n  gv: 23.33,\n  ec: 'product',\n  ea: 'purchase',\n  el: 'product\
    \ 1',\n  ev: '23'                   \n                             });\n// Validate\
    \ that the result of runCode is an uppercase string.\nassertThat(variableResult).isEqualTo('THIS\
    \ IS A TEST');"


___NOTES___

Created on 4/27/2024, 12:10:56 PM


